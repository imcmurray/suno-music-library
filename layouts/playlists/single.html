{{ define "main" }}
{{ $playlistId := .File.BaseFileName }}
{{ $playlists := (index .Site.Data "playlists") | default dict }}
{{ $playlist := index $playlists $playlistId }}
{{ $songs := (index .Site.Data "songs") | default dict }}

{{ if $playlist }}
<div class="playlist-page">
    <header class="playlist-header">
        <div class="playlist-hero">
            {{ if $playlist.coverUrl }}
            <img src="{{ $playlist.coverUrl }}" alt="{{ $playlist.title }}" class="playlist-hero-cover">
            {{ else }}
            <div class="playlist-hero-cover placeholder">
                <svg viewBox="0 0 24 24" width="96" height="96"><path fill="currentColor" d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
            </div>
            {{ end }}
            <div class="playlist-hero-info">
                <span class="playlist-type">Playlist</span>
                <h1>{{ $playlist.title }}</h1>
                <p class="playlist-meta">
                    {{ with $playlist.creator }}<span class="creator">{{ . }}</span> &bull; {{ end }}
                    <span>{{ len $playlist.songs }} songs</span>
                </p>
                {{ with $playlist.description }}
                <p class="playlist-description">{{ . }}</p>
                {{ end }}
                <div class="playlist-actions">
                    <button class="btn btn-primary play-all-btn" data-playlist="{{ $playlistId }}">
                        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
                        Play All
                    </button>
                    <button class="btn btn-secondary shuffle-btn" data-playlist="{{ $playlistId }}">
                        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
                        Shuffle
                    </button>
                    {{ with $playlist.url }}
                    <a href="{{ . }}" target="_blank" rel="noopener" class="btn btn-outline">
                        <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>
                        View on Suno
                    </a>
                    {{ end }}
                </div>
            </div>
        </div>
    </header>

    <div class="playlist-songs">
        <div class="song-list" id="playlist-songs" data-playlist="{{ $playlistId }}">
            {{ range $index, $uuid := $playlist.songs }}
            {{ $song := index $songs $uuid }}
            {{ if $song }}
            <div class="song-row" data-uuid="{{ $uuid }}" data-index="{{ $index }}" data-title="{{ $song.title }}" data-artist="{{ $song.artist }}" data-cover="{{ $song.coverUrl }}">
                <span class="song-number">{{ add $index 1 }}</span>
                <div class="song-cover-wrap">
                    {{ if $song.coverUrl }}
                    <img src="{{ $song.coverUrl }}" alt="{{ $song.title }}" class="song-cover" loading="lazy">
                    {{ else }}
                    <div class="song-cover placeholder"></div>
                    {{ end }}
                    <button class="song-play-btn" title="Play">
                        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
                    </button>
                </div>
                <div class="song-info">
                    <span class="song-title">{{ $song.title }}</span>
                    <span class="song-artist">{{ $song.artist }}</span>
                    {{ with $song.style }}<span class="song-style">{{ . }}</span>{{ end }}
                </div>
                <div class="song-actions">
                    <a href="https://suno.com/song/{{ $uuid }}" target="_blank" rel="noopener" class="external-link" title="View on Suno">
                        <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>
                    </a>
                </div>
            </div>
            {{ else }}
            <div class="song-row song-missing" data-uuid="{{ $uuid }}">
                <span class="song-number">{{ add $index 1 }}</span>
                <div class="song-cover-wrap">
                    <div class="song-cover placeholder"></div>
                </div>
                <div class="song-info">
                    <span class="song-title">Unknown Song</span>
                    <span class="song-artist">ID: {{ $uuid }}</span>
                </div>
            </div>
            {{ end }}
            {{ end }}
        </div>
    </div>
</div>
{{ else }}
<div class="error-page">
    <h1>Playlist Not Found</h1>
    <p>This playlist doesn't exist in your library.</p>
    <a href="{{ "/playlists/" | relURL }}" class="btn btn-primary">Browse Playlists</a>
</div>
{{ end }}
{{ end }}
